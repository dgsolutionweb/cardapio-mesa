(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[469],{2989:(e,r,o)=>{"use strict";o.d(r,{A:()=>a});var i=o(1257),t=o(7876);let a=(0,i.A)((0,t.jsx)("path",{d:"M19 13h-6v6h-2v-6H5v-2h6V5h2v6h6z"}),"Add")},4122:(e,r,o)=>{(window.__NEXT_P=window.__NEXT_P||[]).push(["/menu",function(){return o(9519)}])},9099:(e,r,o)=>{e.exports=o(8253)},9519:(e,r,o)=>{"use strict";o.r(r),o.d(r,{default:()=>D});var i=o(7876),t=o(9099),a=o(4232),s=o(3930),n=o(964),d=o(6520),l=o(5965),c=o(1054),p=o(1428),m=o(7223),u=o(9241),x=o(1849),h=o(3323),g=o(5279),b=o(7929),f=o(9093);let v=(0,o(5556).A)(),y=(0,f.A)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,r)=>{let{ownerState:o}=e;return[r.root,r[`maxWidth${(0,g.A)(String(o.maxWidth))}`],o.fixed&&r.fixed,o.disableGutters&&r.disableGutters]}}),A=e=>(0,b.A)({props:e,name:"MuiContainer",defaultTheme:v}),j=(e,r)=>{let{classes:o,fixed:i,disableGutters:t,maxWidth:a}=e,s={root:["root",a&&`maxWidth${(0,g.A)(String(a))}`,i&&"fixed",t&&"disableGutters"]};return(0,h.A)(s,e=>(0,x.Ay)(r,e),o)};var w=o(8037),k=o(7947),C=o(985);let I=function(e={}){let{createStyledComponent:r=y,useThemeProps:o=A,componentName:t="MuiContainer"}=e,s=r(({theme:e,ownerState:r})=>({width:"100%",marginLeft:"auto",boxSizing:"border-box",marginRight:"auto",...!r.disableGutters&&{paddingLeft:e.spacing(2),paddingRight:e.spacing(2),[e.breakpoints.up("sm")]:{paddingLeft:e.spacing(3),paddingRight:e.spacing(3)}}}),({theme:e,ownerState:r})=>r.fixed&&Object.keys(e.breakpoints.values).reduce((r,o)=>{let i=e.breakpoints.values[o];return 0!==i&&(r[e.breakpoints.up(o)]={maxWidth:`${i}${e.breakpoints.unit}`}),r},{}),({theme:e,ownerState:r})=>({..."xs"===r.maxWidth&&{[e.breakpoints.up("xs")]:{maxWidth:Math.max(e.breakpoints.values.xs,444)}},...r.maxWidth&&"xs"!==r.maxWidth&&{[e.breakpoints.up(r.maxWidth)]:{maxWidth:`${e.breakpoints.values[r.maxWidth]}${e.breakpoints.unit}`}}}));return a.forwardRef(function(e,r){let a=o(e),{className:n,component:d="div",disableGutters:l=!1,fixed:c=!1,maxWidth:p="lg",classes:m,...x}=a,h={...a,component:d,disableGutters:l,fixed:c,maxWidth:p},g=j(h,t);return(0,i.jsx)(s,{as:d,ownerState:h,className:(0,u.A)(g.root,n),ref:r,...x})})}({createStyledComponent:(0,k.Ay)("div",{name:"MuiContainer",slot:"Root",overridesResolver:(e,r)=>{let{ownerState:o}=e;return[r.root,r["maxWidth".concat((0,w.A)(String(o.maxWidth)))],o.fixed&&r.fixed,o.disableGutters&&r.disableGutters]}}),useThemeProps:e=>(0,C.b)({props:e,name:"MuiContainer"})});var E=o(2460),S=o(2039),M=o(9299),W=o(6448),_=o(4527),z=o(2643),R=o(2199),O=o(7438),N=o(2989),P=o(1257);let G=(0,P.A)((0,i.jsx)("path",{d:"M19 13H5v-2h14z"}),"Remove"),$=(0,P.A)((0,i.jsx)("path",{d:"M7 18c-1.1 0-1.99.9-1.99 2S5.9 22 7 22s2-.9 2-2-.9-2-2-2M1 2v2h2l3.6 7.59-1.35 2.45c-.16.28-.25.61-.25.96 0 1.1.9 2 2 2h12v-2H7.42c-.14 0-.25-.11-.25-.25l.03-.12.9-1.63h7.45c.75 0 1.41-.41 1.75-1.03l3.58-6.49c.08-.14.12-.31.12-.48 0-.55-.45-1-1-1H5.21l-.94-2zm16 16c-1.1 0-1.99.9-1.99 2s.89 2 1.99 2 2-.9 2-2-.9-2-2-2"}),"ShoppingCart"),H=(0,P.A)((0,i.jsx)("path",{d:"M2.01 21 23 12 2.01 3 2 10l15 2-15 2z"}),"Send"),q=(0,s.UU)("https://ajwmtfpsuxuunncovkqv.supabase.co","eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImFqd210ZnBzdXh1dW5uY292a3F2Iiwicm9sZSI6ImFub24iLCJpYXQiOjE3NDg5MjQ1MTAsImV4cCI6MjA2NDUwMDUxMH0.KH4qq9dlEl9w7mbERPxrae58kdtXWcGdseOc_h6YMjY");function D(){let{table:e}=(0,t.useRouter)().query,[r,o]=(0,a.useState)([]),[s,u]=(0,a.useState)(!0),[x,h]=(0,a.useState)({}),[g,b]=(0,a.useState)({open:!1,message:"",severity:"info"}),[f,v]=(0,a.useState)(!1),y=(0,n.A)(),A=(0,a.useCallback)(async()=>{try{console.log("Buscando itens do menu..."),u(!0);let{data:e,error:r}=await q.from("menu_items").select("*").order("name");if(r){console.error("Erro ao buscar menu:",r),b({open:!0,message:"Erro ao carregar card\xe1pio: ".concat(r.message),severity:"error"});return}e&&(console.log("".concat(e.length," itens encontrados no card\xe1pio")),o(e))}catch(e){console.error("Exce\xe7\xe3o ao buscar menu:",e),b({open:!0,message:"Erro inesperado: ".concat(e),severity:"error"})}finally{u(!1)}},[]);(0,a.useEffect)(()=>{A()},[A]);let j=e=>{h(r=>({...r,[e]:(r[e]||0)+1}))},w=e=>{h(r=>{let o={...r};return o[e]>0&&(o[e]-=1),0===o[e]&&delete o[e],o})},k=()=>{b({...g,open:!1})},C=()=>Object.values(x).reduce((e,r)=>e+r,0),P=()=>Object.entries(x).reduce((e,o)=>{let[i,t]=o,a=r.find(e=>e.id===Number(i));return e+(a?a.price*t:0)},0),D=async()=>{try{if(0===C())return void b({open:!0,message:"Adicione pelo menos um item ao pedido",severity:"warning"});if(!e)return void b({open:!0,message:"Mesa n\xe3o identificada!",severity:"error"});v(!0),console.log("Enviando pedido para a mesa ".concat(e,"..."));let{data:r,error:o}=await q.from("tables").select("id, number").eq("number",e).single();if(o||!r){console.error("Erro ao buscar mesa:",o),b({open:!0,message:"Mesa inv\xe1lida!",severity:"error"}),v(!1);return}let i=Object.entries(x).filter(e=>{let[r,o]=e;return o>0});if(0===i.length){b({open:!0,message:"Adicione pelo menos um item ao pedido",severity:"warning"}),v(!1);return}let t=P();console.log("Total do pedido: R$ ".concat(t.toFixed(2)));let{data:a,error:s}=await q.from("orders").insert({table_id:r.id,status:"pending",total:t,created_at:new Date().toISOString()}).select().single();if(s){console.error("Erro ao criar pedido:",s),b({open:!0,message:"Erro ao criar pedido: ".concat(s.message),severity:"error"}),v(!1);return}if(!a){console.error("Pedido criado, mas sem dados retornados"),b({open:!0,message:"Erro ao criar pedido: sem dados retornados",severity:"error"}),v(!1);return}console.log("Pedido ".concat(a.id," criado com sucesso. Adicionando itens..."));let n=i.map(async e=>{let[r,o]=e,{error:i}=await q.from("order_items").insert({order_id:a.id,menu_item_id:Number(r),quantity:o});return!i||(console.error("Erro ao adicionar item ".concat(r," ao pedido:"),i),!1)}),d=await Promise.all(n),{error:l}=await q.from("tables").update({status:"occupied"}).eq("id",r.id);l?console.error("Erro ao atualizar status da mesa:",l):console.log("Mesa ".concat(e," marcada como ocupada")),d.some(e=>!e)?b({open:!0,message:"Alguns itens n\xe3o puderam ser adicionados ao pedido",severity:"warning"}):(console.log("Todos os itens adicionados com sucesso"),b({open:!0,message:"Pedido enviado para a cozinha!",severity:"success"}),h({}))}catch(e){console.error("Exce\xe7\xe3o ao enviar pedido:",e),b({open:!0,message:"Erro inesperado: ".concat(e),severity:"error"})}finally{v(!1)}};return s?(0,i.jsx)(d.A,{sx:{display:"flex",justifyContent:"center",alignItems:"center",height:"100vh"},children:(0,i.jsx)(l.A,{size:60})}):(0,i.jsxs)(d.A,{sx:{display:"flex",flexDirection:"column",minHeight:"100vh",background:y.palette.grey[50],pb:8},children:[(0,i.jsxs)(c.A,{elevation:2,sx:{position:"sticky",top:0,zIndex:10,p:2,mb:2,display:"flex",justifyContent:"space-between",alignItems:"center",borderRadius:0},children:[(0,i.jsxs)(p.A,{variant:"h5",component:"h1",sx:{fontWeight:600},children:["Card\xe1pio - Mesa ",e]}),(0,i.jsx)(m.A,{badgeContent:C(),color:"primary",showZero:!1,sx:{"& .MuiBadge-badge":{fontSize:"0.8rem",fontWeight:"bold"}},children:(0,i.jsx)($,{color:"primary"})})]}),(0,i.jsxs)(I,{maxWidth:"lg",sx:{flex:1},children:[(0,i.jsx)(d.A,{sx:{display:"flex",flexWrap:"wrap",gap:2},children:r.map(e=>(0,i.jsx)(d.A,{sx:{width:{xs:"100%",sm:"calc(50% - 8px)",md:"calc(33.333% - 10.667px)"}},children:(0,i.jsxs)(E.A,{elevation:2,sx:{height:"100%",display:"flex",flexDirection:"column",transition:"transform 0.2s","&:hover":{transform:"translateY(-4px)",boxShadow:y.shadows[4]}},children:[e.image_url?(0,i.jsx)(d.A,{sx:{height:180,backgroundImage:"url(".concat(e.image_url,")"),backgroundSize:"cover",backgroundPosition:"center"},"aria-label":e.name}):(0,i.jsx)(d.A,{sx:{height:180,backgroundColor:y.palette.grey[200],display:"flex",alignItems:"center",justifyContent:"center"},children:(0,i.jsx)(p.A,{variant:"body2",color:"textSecondary",children:"Sem imagem"})}),(0,i.jsxs)(S.A,{sx:{flexGrow:1},children:[(0,i.jsx)(p.A,{variant:"h6",component:"h2",gutterBottom:!0,children:e.name}),(0,i.jsx)(p.A,{variant:"body2",color:"textSecondary",sx:{mb:2},children:e.description}),(0,i.jsxs)(p.A,{variant:"h6",color:"primary",sx:{fontWeight:"bold"},children:["R$ ",e.price.toFixed(2)]})]}),(0,i.jsx)(M.A,{}),(0,i.jsxs)(d.A,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",p:1},children:[(0,i.jsx)(W.A,{title:"Remover do pedido",children:(0,i.jsx)("span",{children:(0,i.jsx)(_.A,{onClick:()=>w(e.id),disabled:!x[e.id],color:"primary",size:"small",children:(0,i.jsx)(G,{})})})}),(0,i.jsx)(p.A,{variant:"body1",sx:{fontWeight:"bold",minWidth:"30px",textAlign:"center"},children:x[e.id]||0}),(0,i.jsx)(W.A,{title:"Adicionar ao pedido",children:(0,i.jsx)(_.A,{onClick:()=>j(e.id),color:"primary",size:"small",children:(0,i.jsx)(N.A,{})})})]})]})},e.id))}),C()>0&&(0,i.jsxs)(c.A,{elevation:3,sx:{position:"fixed",bottom:0,left:0,right:0,p:2,zIndex:10,borderRadius:0,display:"flex",justifyContent:"space-between",alignItems:"center",backgroundColor:y.palette.background.paper},children:[(0,i.jsxs)(d.A,{children:[(0,i.jsxs)(p.A,{variant:"subtitle1",children:[C()," ",1===C()?"item":"itens"]}),(0,i.jsxs)(p.A,{variant:"h6",color:"primary",sx:{fontWeight:"bold"},children:["Total: R$ ",P().toFixed(2)]})]}),(0,i.jsx)(z.A,{variant:"contained",color:"primary",size:"large",disabled:f||0===C(),onClick:D,startIcon:(0,i.jsx)(H,{}),sx:{borderRadius:"24px",px:3},children:f?"Enviando...":"Enviar Pedido"})]})]}),(0,i.jsx)(R.A,{open:g.open,autoHideDuration:6e3,onClose:k,anchorOrigin:{vertical:"top",horizontal:"center"},children:(0,i.jsx)(O.A,{onClose:k,severity:g.severity,variant:"filled",sx:{width:"100%"},children:g.message})})]})}}},e=>{var r=r=>e(e.s=r);e.O(0,[942,714,636,593,792],()=>r(4122)),_N_E=e.O()}]);